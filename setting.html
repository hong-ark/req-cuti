<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ADMIN SETTING LIBUR & CUTI</title>

<style>
body{
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  background:#fff;
  width:820px;
  max-width:95%;
  padding:30px;
  border-radius:20px;
  box-shadow:0 18px 40px rgba(0,0,0,.25);
}
h2{
  text-align:center;
  margin-bottom:10px;
  color:#4e54c8;
}
.desc{
  text-align:center;
  font-size:13px;
  color:#666;
  margin-bottom:20px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:24px;
}
.box{
  background:#f7f9ff;
  padding:20px;
  border-radius:16px;
  border:1px solid #dbe2ff;
}
.box h3{
  margin-top:0;
  margin-bottom:15px;
  font-size:16px;
  color:#333;
}
label{
  font-size:13px;
  font-weight:600;
  display:block;
  margin-top:12px;
}
input, textarea{
  width:100%;
  margin-top:6px;
  padding:11px 13px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
  box-sizing:border-box;
}
input[readonly], textarea[readonly]{
  background:#eee;
  color:#555;
}
textarea{resize:none}
button{
  width:100%;
  margin-top:26px;
  padding:15px;
  border:none;
  border-radius:14px;
  background:linear-gradient(90deg,#11998e,#38ef7d);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}
button:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 22px rgba(17,153,142,.4);
}
#status{
  margin-top:16px;
  text-align:center;
  font-weight:600;
  min-height:22px;
}
.success{color:#155724}
.error{color:#721c24}
small{font-size:12px;color:#666}
footer{
  margin-top:18px;
  text-align:center;
  font-size:12px;
  color:#eee;
}
@media(max-width:800px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="container">
  <h2>ADMIN SETTING LIBUR & CUTI</h2>
  <div class="desc">
    Atur limit & libur tanpa edit script.  
    Ganti URL GAS setiap bulan jika Web App berubah.
  </div>

  <!-- ===================== URL GAS ===================== -->
  <div class="box" style="margin-bottom:20px;">
    <h3>üîó Google Apps Script (Web App)</h3>
    <label>URL GAS Aktif</label>
    <input type="text" id="gasUrl"
      placeholder="https://script.google.com/macros/s/XXXXX/exec">
    <small>
      Diisi 1x setiap bulan sesuai Web App GAS yang aktif.<br>
      Disimpan otomatis di browser admin.
    </small>
  </div>

  <div class="grid">

    <!-- ===================== AKTIF ===================== -->
    <div class="box">
      <h3>üìå Setting Aktif Saat Ini</h3>

      <label>Limit Off / Cuti per Hari</label>
      <input type="text" id="curMaxHarian" readonly>

      <label>Limit Libur per User</label>
      <input type="text" id="curMaxUser" readonly>

      <label>Special Holiday</label>
      <textarea id="curHoliday" rows="3" readonly></textarea>
    </div>

    <!-- ===================== EDIT ===================== -->
    <div class="box">
      <h3>‚úèÔ∏è Ubah Setting</h3>

      <label>Limit Off / Cuti per Hari</label>
      <input type="number" id="newMaxHarian" min="1">

      <label>Limit Libur per User</label>
      <input type="number" id="newMaxUser" min="1">

      <label>Special Holiday</label>
      <textarea id="newHoliday" rows="3"
        placeholder="YYYY-MM-DD,YYYY-MM-DD"></textarea>
      <small>Contoh: 2026-01-01,2026-01-16</small>
    </div>

  </div>

  <button onclick="saveConfig()">üíæ SIMPAN SETTING</button>
  <div id="status"></div>
</div>

<footer>¬© 2025 EDP Fai</footer>

<script>
/* ===================== STORAGE ===================== */
const STORAGE_KEY = "GAS_WEBAPP_URL";

/* ===================== STORAGE HELPERS ===================== */
function getGasUrl(){
  return localStorage.getItem(STORAGE_KEY) || "";
}
function setGasUrl(url){
  localStorage.setItem(STORAGE_KEY, url);
}

/* ===================== LOAD CONFIG ===================== */
async function loadConfig(){
  const status = document.getElementById("status");
  const gasUrl = getGasUrl();

  document.getElementById("gasUrl").value = gasUrl;

  if (!gasUrl){
    status.textContent = "‚ö†Ô∏è Masukkan URL GAS terlebih dahulu";
    status.className = "error";
    return;
  }

  status.textContent = "‚è≥ Memuat setting...";
  status.className = "";

  try{
    const res = await fetch(gasUrl + "?mode=config");
    const cfg = await res.json();

    // tampilkan nilai aktif
    curMaxHarian.value = cfg.MAX_KUOTA_HARIAN ?? "-";
    curMaxUser.value   = cfg.MAX_LIBUR_USER ?? "-";
    curHoliday.value   = cfg.SPECIAL_HOLIDAYS || "-";

    // isi form edit
    newMaxHarian.value = cfg.MAX_KUOTA_HARIAN ?? "";
    newMaxUser.value   = cfg.MAX_LIBUR_USER ?? "";
    newHoliday.value   = cfg.SPECIAL_HOLIDAYS || "";

    status.textContent = "‚úîÔ∏è Setting aktif berhasil dimuat";
    status.className = "success";
  }catch(err){
    status.textContent = "‚ùå Gagal mengambil data dari GAS";
    status.className = "error";
  }
}

/* ===================== SAVE CONFIG ===================== */
async function saveConfig(){
  const status = document.getElementById("status");
  const gasUrl = document.getElementById("gasUrl").value.trim();

  if (!gasUrl){
    status.textContent = "‚ùå URL GAS wajib diisi";
    status.className = "error";
    return;
  }

  // simpan URL ke browser
  setGasUrl(gasUrl);

  status.textContent = "‚è≥ Menyimpan setting...";
  status.className = "";

  const fd = new FormData();
  fd.append("mode","saveConfig");
  fd.append("MAX_KUOTA_HARIAN", newMaxHarian.value);
  fd.append("MAX_LIBUR_USER", newMaxUser.value);
  fd.append("SPECIAL_HOLIDAYS", newHoliday.value.trim());

  try{
    const res = await fetch(gasUrl,{ method:"POST", body:fd });
    const j = await res.json();

    if(j.status==="success"){
      status.textContent = "‚úÖ Setting berhasil disimpan & langsung aktif";
      status.className = "success";
      loadConfig();
    }else{
      status.textContent = "‚ùå Gagal menyimpan setting";
      status.className = "error";
    }
  }catch(err){
    status.textContent = "‚ùå Tidak bisa terhubung ke GAS";
    status.className = "error";
  }
}

/* ===================== INIT ===================== */
loadConfig();
</script>

</body>
</html>
