<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ADMIN SETTING LIBUR & CUTI</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.css">

<style>
body{
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  background:#fff;
  width:820px;
  max-width:95%;
  padding:30px;
  border-radius:20px;
  box-shadow:0 18px 40px rgba(0,0,0,.25);
}
h2{text-align:center;color:#4e54c8;margin-bottom:8px}
.desc{text-align:center;font-size:13px;color:#666;margin-bottom:20px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
.box{
  background:#f7f9ff;
  padding:20px;
  border-radius:16px;
  border:1px solid #dbe2ff;
}
.box h3{margin-top:0;font-size:16px}
label{font-size:13px;font-weight:600;margin-top:12px;display:block}
input{
  width:100%;margin-top:6px;padding:11px 13px;
  border-radius:10px;border:1px solid #ccc;font-size:14px;
}
input[readonly]{background:#eee}
button{
  width:100%;margin-top:26px;padding:15px;
  border:none;border-radius:14px;
  background:linear-gradient(90deg,#11998e,#38ef7d);
  color:#fff;font-size:15px;font-weight:600;cursor:pointer;
}
#status{text-align:center;margin-top:14px;font-weight:600}
.success{color:#155724}
.error{color:#721c24}
small{font-size:12px;color:#666}
footer{text-align:center;font-size:12px;color:#eee;margin-top:18px}
@media(max-width:800px){.grid{grid-template-columns:1fr}}
</style>
</head>

<body>

<div class="container">
<h2>ADMIN SETTING LIBUR & CUTI</h2>
<div class="desc">
Panel admin terpusat ‚Äì tanpa masalah timezone / indochina
</div>

<!-- GAS -->
<div class="box" style="margin-bottom:20px">
<h3>üîó GAS JAWABAN</h3>
<label>URL Web App GAS</label>
<input type="text" id="gasUrl">
</div>

<div class="grid">

<!-- AKTIF -->
<div class="box">
<h3>üìå Setting Aktif</h3>
<label>Limit Harian</label>
<input readonly id="curMaxHarian">
<label>Limit Libur User</label>
<input readonly id="curMaxUser">
<label>Special Holiday (String)</label>
<input readonly id="curHoliday">
</div>

<!-- EDIT -->
<div class="box">
<h3>‚úèÔ∏è Ubah Setting</h3>
<label>Limit Harian</label>
<input type="number" id="newMaxHarian" min="1">
<label>Limit Libur User</label>
<input type="number" id="newMaxUser" min="1">
<label>Special Holiday (Klik kalender)</label>
<input type="text" id="holidayPicker" readonly>
<small>Klik tanggal ‚Üí otomatis aman YYYY-MM-DD</small>
</div>

</div>

<button onclick="saveConfig()">üíæ SIMPAN SETTING</button>
<div id="status"></div>
</div>

<footer>¬© 2025 EDP Fai</footer>

<script src="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.js"></script>
<script>
/* ================= KONFIG ================= */
const MASTER_GAS_URL =
"https://script.google.com/macros/s/AKfycby1XWMOjxdQXNqkNpKtayd0c55ZK3VkQvaZ_KSqibEUBjExlvaVUzunpfe4_HPnDX1q/exec";

let holidayDates = [];

/* ================= UTIL ================= */
function status(msg, err){
  const el=document.getElementById("status");
  el.textContent=msg;
  el.className=err?"error":"success";
}

function toYMD(date){
  const y = date.getFullYear();
  const m = String(date.getMonth()+1).padStart(2,"0");
  const d = String(date.getDate()).padStart(2,"0");
  return `${y}-${m}-${d}`;
}

/* ================= DATEPICKER ================= */
const dp = new AirDatepicker('#holidayPicker',{
  multipleDates:true,
  dateFormat:'yyyy-MM-dd',

  firstDay: 0, // ‚úÖ MINGGU SEBAGAI HARI PERTAMA

  locale:{ 
    days:['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],
    daysMin:['Mg','Sn','Sl','Rb','Km','Jm','Sb'],
    months:['Januari','Februari','Maret','April','Mei','Juni',
            'Juli','Agustus','September','Oktober','November','Desember']
  },

  onSelect({date}){
    holidayDates = (date || []).map(d => toYMD(d));
    holidayPicker.value = holidayDates.join(", ");
  }
});


/* ================= LOAD ================= */
async function loadConfig(){
  status("‚è≥ Memuat...");
  try{
    const r = await fetch(MASTER_GAS_URL+"?mode=getMasterConfig");
    const m = await r.json();

    gasUrl.value = m.GAS_URL || "";
    if(!m.GAS_URL){ status("‚ö†Ô∏è GAS_URL belum di-set", true); return; }

    const r2 = await fetch(m.GAS_URL+"?mode=config");
    const s = await r2.json();

    curMaxHarian.value = s.MAX_KUOTA_HARIAN ?? "-";
    curMaxUser.value   = s.MAX_LIBUR_USER ?? "-";
    curHoliday.value   = s.SPECIAL_HOLIDAYS || "-";

    newMaxHarian.value = s.MAX_KUOTA_HARIAN ?? "";
    newMaxUser.value   = s.MAX_LIBUR_USER ?? "";

    // preload calendar
    if(s.SPECIAL_HOLIDAYS){
      const arr = s.SPECIAL_HOLIDAYS.split(",");
      dp.selectDate(arr.map(x=>new Date(x)));
    }

    status("‚úîÔ∏è Loaded");
  }catch{
    status("‚ùå Gagal load", true);
  }
}

/* ================= SAVE ================= */
async function saveConfig(){
  if(!gasUrl.value.trim()){ status("‚ùå URL GAS wajib", true); return; }

  status("‚è≥ Menyimpan...");

  try{
    // save master
    const fd1=new FormData();
    fd1.append("mode","saveMasterConfig");
    fd1.append("GAS_URL",gasUrl.value.trim());
    await fetch(MASTER_GAS_URL,{method:"POST",body:fd1});

    // save config
    const fd2=new FormData();
    fd2.append("mode","saveConfig");
    fd2.append("MAX_KUOTA_HARIAN",newMaxHarian.value);
    fd2.append("MAX_LIBUR_USER",newMaxUser.value);
    fd2.append("SPECIAL_HOLIDAYS",holidayDates.join(","));
    await fetch(gasUrl.value.trim(),{method:"POST",body:fd2});

    status("‚úÖ Setting tersimpan");
    loadConfig();
  }catch{
    status("‚ùå Gagal simpan", true);
  }
}

loadConfig();
</script>

</body>
</html>

