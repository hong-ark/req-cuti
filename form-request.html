<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title id="page-title">REQUEST LIBUR / CUTI</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.css">

<style>
body{
  font-family:"Poppins","Segoe UI",Arial,sans-serif;
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#bdbdbd,#e0e0e0);
  padding:20px;
  color:#e5e5e5;
}

.container{
  background:#0f0f0f;
  padding:35px 30px 50px;
  border-radius:18px;
  width:480px;
  max-width:100%;
  box-shadow:0 12px 30px rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.05);
}

/* ===== JUDUL ===== */
h2{
  text-align:center;
  font-size:26px;
  font-weight:800;
  color:#ffffff;
  letter-spacing:1px;
  margin-bottom:18px;
}

/* ===== INFO ===== */
#info-text{
  font-size:14px;
  color:#d1d1d1;
  text-align:center;
  margin-bottom:22px;
  padding:14px 16px;
  border-radius:12px;
  background:#1a1a1a;
  border:1px solid #333;
  font-weight:600;
}

/* ===== FORM ===== */
label{
  font-weight:600;
  color:#dddddd;
}

input,select{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #333;
  background:#1a1a1a;
  color:#ffffff;
  margin-bottom:14px;
}

input::placeholder{
  color:#888;
}

input[readonly]{
  background:#151515;
}

/* ===== BUTTON ===== */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2f2f2f;
  color:#ffffff;
  font-weight:700;
  cursor:pointer;
  transition:background .3s ease;
}

button:hover{
  background:#444;
}

/* ===== STATUS ===== */
#status{
  margin-top:14px;
  text-align:center;
  font-weight:700;
}

.success{
  color:#b7f5c7;
  background:#0f3d22;
  padding:8px;
  border-radius:8px;
}

.error{
  color:#f5b7b7;
  background:#3d0f0f;
  padding:8px;
  border-radius:8px;
}

/* ===== LOADING ===== */
#loading{
  text-align:center;
  font-weight:600;
}

.loading-text{
  margin-top:12px;
  font-weight:600;
  font-size:14px;
  color:#bbbbbb;
}

/* ===== FOOTER ===== */
#footer{
  text-align:center;
  margin-top:25px;
  font-size:13px;
  color:#b0b0b0;
}

#copyright{
  margin-top:25px;
  font-size:12px;
  opacity:.7;
  color:#444;
}

/* ===== DATEPICKER ===== */
.air-datepicker{
  background:#0f0f0f !important;
  color:#ffffff;
}

.air-datepicker-cell{
  color:#dddddd;
}

.air-datepicker-cell.-selected-{
  background:#444 !important;
}

.air-datepicker-cell.weekend-red{
  color:#ff6b6b !important;
}

.air-datepicker-cell.holiday-red{
  color:#ff6b6b !important;
}
  /* ===== LOADING DOTS (FIX) ===== */
.dot-loader{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

.dots{
  display:flex;
  gap:12px;
  margin-top:10px;
}

.dots span{
  width:14px;
  height:14px;
  border-radius:4px;
  background:#aaa;
  animation:squareBounce 1.2s infinite ease-in-out both;
}

/* warna netral biar cocok dark */
.dots span:nth-child(1){
  background:#ff6b6b;
}
.dots span:nth-child(2){
  background:#4dabf7;
}
.dots span:nth-child(3){
  background:#ffd43b;
}

.dots span:nth-child(1){ animation-delay:0s; }
.dots span:nth-child(2){ animation-delay:.15s; }
.dots span:nth-child(3){ animation-delay:.3s; }

@keyframes squareBounce{
  0%,80%,100%{
    transform:translateY(0) scale(0.9);
    opacity:.5;
  }
  40%{
    transform:translateY(-12px) scale(1.1);
    opacity:1;
  }
}

</style>
</head>

<body>

<div class="container">
  <h2 id="header-text"></h2>

  <div id="info-text">
    Silakan Request Jadwal sesuai keperluan saja<br>
    Inputan bisa direvisi / diganti berulang kali. Gunakan dengan bijak!
  </div>

  <div id="loading" class="dot-loader">
  <div class="dots">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div class="loading-text">Memuat data...</div>
</div>

  <form id="requestForm" style="display:none;">
    <label>NIK</label>
    <input id="nik" name="nik" readonly>

    <label>Nama</label>
    <input id="nama" name="nama" readonly>

    <label>Group</label>
    <input id="group" name="group" readonly>

    <label>Request Libur</label>
<input id="libur" name="libur" readonly placeholder="Klik untuk pilih tanggal">

<label>Request Cuti</label>
<input id="cuti" name="cuti" readonly placeholder="Klik untuk pilih tanggal">

<label>Request Lainnya</label>
<input
  id="requestLainnya"
  name="requestLainnya"
  maxlength="80"
  placeholder="Req tambahan silakan tulis disini">


    <label>Ekstrakulikuler</label>
    <select id="ekstrakulikuler" name="ekstrakulikuler" required>
      <option value="">-- Pilih --</option>
      <option>FUTSAL</option>
      <option>BADMINTON</option>
      <option>FUTSAL & BADMINTON</option>
      <option>TIDAK MENGIKUTI</option>
    </select>

    <button type="submit">KIRIM REQUEST</button>
    <div id="status"></div>

    <div id="footer">
      <div id="footer-note"></div>
      <div id="countdown"></div>
    </div>
  </form>
</div>

<footer id="copyright">© 2025 EDP Fai</footer>

<script src="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.js"></script>
<script>
/* ================= CONFIG ================= */
const CONFIG_SERVICE_URL =
"https://script.google.com/macros/s/AKfycbxgdC5vXNNA7LOgEf-WUlpzjx5NZQOG8IxFBkceOl7XOZarDomGSLjEWFvUh6pvjhbo/exec";

let GAS_URL = "";
let MAX_LIBUR_USER = 0;
let SPECIAL_HOLIDAYS = [];
let IS_REVISION = false;

const monthNames = [
  "Januari","Februari","Maret","April","Mei","Juni",
  "Juli","Agustus","September","Oktober","November","Desember"
];
/* ✅ TAMBAHKAN INI */
const localeID = {
  days: ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],
  daysShort: ['Min','Sen','Sel','Rab','Kam','Jum','Sab'],
  daysMin: ['Mg','Sn','Sl','Rb','Km','Jm','Sb'],
  months: monthNames,
  monthsShort: ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'],
  today: 'Hari ini',
  clear: 'Bersihkan',
  dateFormat: 'dd/MM/yyyy',
  timeFormat: 'HH:mm',
  firstDay: 0
};
/* ================= HEADER ================= */
(function(){
  const now = new Date();
  const next = new Date(now.getFullYear(), now.getMonth() + 1, 1);
  const m = monthNames[next.getMonth()].toUpperCase();

  const headerEl = document.getElementById("header-text");
  const titleEl  = document.getElementById("page-title");
  const footerEl = document.getElementById("footer-note");

  if (headerEl) headerEl.textContent = `REQUEST LIBUR / CUTI BULAN ${m}`;
  if (titleEl)  titleEl.textContent  = `REQUEST LIBUR / CUTI BULAN ${m}`;
  if (footerEl) {
    footerEl.innerHTML =
      `Kuota libur bulan <b>${m}</b>.<br>
       8 jika Lembur, Tidak Lembur = 9.<br>
       Jika kuota hari penuh tidak bisa direquest.`;
  }
})();

/* ================= PARAM ================= */
const qs = new URLSearchParams(location.search);
const nik   = document.getElementById("nik");
const nama  = document.getElementById("nama");
const group = document.getElementById("group");

nik.value   = qs.get("nik")   || "";
nama.value  = qs.get("nama")  || "";
group.value = qs.get("group") || "";

/* ================= LOAD CONFIG ================= */
async function loadConfig(){
  const cfg = await (await fetch(CONFIG_SERVICE_URL + "?mode=getMasterConfig")).json();
  GAS_URL = cfg.GAS_URL;

  const c = await (await fetch(GAS_URL + "?mode=config")).json();
  MAX_LIBUR_USER = Number(c.MAX_LIBUR_USER || 0);

  SPECIAL_HOLIDAYS = [];
  if (c.SPECIAL_HOLIDAYS) {
    String(c.SPECIAL_HOLIDAYS).split(",").forEach(s => {
      const d = new Date(s.trim());
      if (!isNaN(d)) SPECIAL_HOLIDAYS.push(d);
    });
  }
}

/* ================= DATEPICKER ================= */
function initPicker(id, full, raw){
  const el = document.getElementById(id);
  if (el._adp) el._adp.destroy();

  const now = new Date();
  const startMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
  const endMonth   = new Date(now.getFullYear(), now.getMonth() + 2, 0);

  el._adp = new AirDatepicker(el,{
    multipleDates: id === "libur" ? MAX_LIBUR_USER : true,
    dateFormat: "d",
    view: "days",
    minView: "days",
    locale: localeID,

    minDate: startMonth,
    maxDate: endMonth,

    selectedDates: (raw||"").split(",").filter(Boolean)
      .map(d => new Date(
        startMonth.getFullYear(),
        startMonth.getMonth(),
        Number(d)
      )),

    disabledDates: (full||[])
      .map(d => new Date(
        startMonth.getFullYear(),
        startMonth.getMonth(),
        Number(d)
      )),

    onRenderCell: ({date, cellType})=>{
      if (cellType !== "day") return;

      const cls = [];
      if (date.getDay()===0 || date.getDay()===6) cls.push("weekend-red");

      if (SPECIAL_HOLIDAYS.some(h =>
        h.getFullYear()===date.getFullYear() &&
        h.getMonth()===date.getMonth() &&
        h.getDate()===date.getDate()
      )) cls.push("holiday-red");

      if (cls.length) return { classes: cls.join(" ") };
    }
  });
}


/* ================= BOOT ================= */
(async()=>{
  try{
    await loadConfig();

    const res = await fetch(`${GAS_URL}?nik=${nik.value}`);
    const d = await res.json();

    let l="", c="";
    if (d.status==="found"){
      IS_REVISION = true;
      l=d.libur||""; c=d.cuti||"";
      libur.value=l; cuti.value=c;
      requestLainnya.value=d.requestLainnya||"";
      ekstrakulikuler.value=d.ekstrakulikuler||"";
    }

    const full = await (await fetch(GAS_URL)).json();
    initPicker("libur", full, l);
    initPicker("cuti", full, c);

    loading.style.display="none";
    requestForm.style.display="block";
  }catch(e){
    loading.textContent="❌ "+e.message;
  }
})();

/* ================= SUBMIT ================= */
requestForm.addEventListener("submit", async e=>{
  e.preventDefault();

  const status = document.getElementById("status");
  status.textContent = "⏳ Mengirim...";
  status.className = "";

  const liburCount = (libur.value||"").split(",").filter(Boolean).length;
  if (liburCount > MAX_LIBUR_USER){
    status.textContent = `❌ Maksimal ${MAX_LIBUR_USER} tanggal libur`;
    status.className = "error";
    return;
  }

  const fd = new FormData(requestForm);
  fd.append("mode", "save");     // ✅ sesuai GAS
  fd.append("return", "json");

  try{
    const res  = await fetch(GAS_URL, { method:"POST", body: fd });
    const text = await res.text();

    let json;
    try { json = JSON.parse(text); } catch {}

    if (json?.status === "success"){
  status.textContent = IS_REVISION
    ? "✅ DATA BERHASIL DIREVISI"
    : "✅ DATE BERHASIL DISIMPAN";
  status.className = "success";
    } else {
      status.textContent = json?.message
        ? "❌ " + json.message
        : "❌ " + text;
      status.className = "error";
    }
  }catch(err){
    status.textContent = "❌ Gagal mengirim data";
    status.className = "error";
    console.error(err);
  }
});
</script>
</body>
</html>
















