<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title id="page-title">REQUEST LIBUR / CUTI JADWAL BULAN DEPAN</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.css">

<style>
/* --- STYLE CSS MODERN --- */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #74ebd5, #ACB6E5);
  padding: 20px;
}
.container {
  background: #fff;
  padding: 35px 30px 40px;
  border-radius: 20px;
  box-shadow: 0 12px 35px rgba(0,0,0,0.15);
  width: 480px;
  max-width: 100%;
  animation: fadeIn 0.6s ease-in-out;
  position: relative;
}
h2 {
  text-align: center;
  margin-bottom: 25px;
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(90deg, #4e54c8, #8f94fb);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 1px;
}
label { font-weight: 600; margin-bottom: 6px; display: block; }
input, select {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ddd;
  border-radius: 10px;
  margin-bottom: 16px;
}
input[disabled], select[disabled] {
  background: #eee;
  color: #777;
}
button[type="submit"] {
  width: 100%; padding: 14px; font-weight: 600;
  background: linear-gradient(90deg, #11998e, #38ef7d);
  border: none; border-radius: 12px; color: #fff;
}
button[disabled] {
  background: #ccc !important;
  cursor: not-allowed;
}
#status { margin-top: 12px; text-align: center; font-size: 14px; }
.success { color: #155724; background: #d4edda; padding: 6px; border-radius: 8px; }
.error { color: #721c24; background: #f8d7da; padding: 6px; border-radius: 8px; }
#footer { margin-top: 20px; text-align:center; font-size: 12px; color: #444; }
#countdown { font-weight: 600; color: #d63384; margin-top: 5px; }
@keyframes fadeIn { from{opacity:0;transform:translateY(-15px);} to{opacity:1;transform:translateY(0);} }
</style>
</head>
<body>
<div class="container">
  <h2 id="header-text">REQUEST LIBUR / CUTI JADWAL BULAN DEPAN</h2>

  <form id="requestForm">
    <label>NIK</label>
    <input type="text" id="nik" name="nik" readonly>

    <label>Nama</label>
    <input type="text" id="nama" name="nama" readonly>

    <label>Group</label>
    <input type="text" id="group" name="group" readonly>

    <label>Request Libur</label>
    <input type="text" id="libur" name="libur" placeholder="Pilih tanggal libur" readonly>

    <label>Request Cuti</label>
    <input type="text" id="cuti" name="cuti" placeholder="Pilih tanggal cuti" readonly>

    <label>Request Lainnya</label>
    <input type="text" id="requestLainnya" name="requestLainnya" maxlength="80">

    <label>Ekstrakulikuler</label>
    <select id="ekstrakulikuler" name="ekstrakulikuler" required>
      <option value="">-- Pilih --</option>
      <option value="FUTSAL">FUTSAL</option>
      <option value="BADMINTON">BADMINTON</option>
      <option value="FUTSAL & BADMINTON">FUTSAL & BADMINTON</option>
      <option value="TIDAK MENGIKUTI">TIDAK MENGIKUTI</option>
    </select>

    <button type="submit" id="submitBtn">KIRIM REQUEST</button>
    <div id="status"></div>

    <div id="footer">
      Silakan request sesuai keperluan.<br>
      Input bisa direvisi/ganti berulang kali.<br>
      <div id="countdown"></div>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.0/air-datepicker.min.js"></script>
<script>
/* === KONFIGURASI === */
const scriptURL = "https://script.google.com/macros/s/AKfycbzR5rqC-ll3MheqTzwP9CGchyfkOWM04qdUt7h565ty9J7gd4hSfH7ui2pwItInxCUPBQ/exec";
const quotaURL = scriptURL;

const MAX_KUOTA_HARIAN = 21;

/* === UPDATE HEADER BULAN === */
const monthNames = ["Januari","Februari","Maret","April","Mei","Juni",
  "Juli","Agustus","September","Oktober","November","Desember"];
(function updateHeader(){
  const today=new Date();
  const nextMonth=new Date(today.getFullYear(), today.getMonth()+1, 1);
  const nextMonthName=monthNames[nextMonth.getMonth()];
  const headerText=`REQUEST LIBUR / CUTI BULAN ${nextMonthName.toUpperCase()}`;
  document.getElementById('header-text').textContent=headerText;
  document.getElementById('page-title').textContent=headerText;
})();

/* === VALIDASI WAKTU INPUT + COUNTDOWN === */
function checkDeadline() {
  const now = new Date();
  const startDate = new Date(now.getFullYear(), now.getMonth(), 1, 0, 10, 0);
  const expiredDate = new Date(now.getFullYear(), now.getMonth(), 16, 23, 59, 59);

  const btn = document.getElementById("submitBtn");
  const status = document.getElementById("status");
  const libur = document.getElementById("libur");
  const cuti = document.getElementById("cuti");

  if (now < startDate) {
    btn.disabled = true; libur.disabled=true; cuti.disabled=true;
    status.textContent = "❌ Input belum dibuka (mulai 1 jam 00:10).";
    status.className = "error";
    document.getElementById("countdown").textContent="";
  } else if (now > expiredDate) {
    btn.disabled = true; libur.disabled=true; cuti.disabled=true;
    status.textContent = "❌ Deadline input berakhir (16 jam 23:59).";
    status.className = "error";
    document.getElementById("countdown").textContent="";
  } else {
    btn.disabled = false; libur.disabled=false; cuti.disabled=false;
    status.textContent = "";
    status.className = "";
    startCountdown(expiredDate);
  }
}

function startCountdown(deadline) {
  function updateCountdown() {
    const now = new Date().getTime();
    const distance = deadline.getTime() - now;

    if (distance <= 0) {
      document.getElementById("countdown").textContent = "⏳ Waktu request sudah habis.";
      checkDeadline();
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000*60*60*24))/(1000*60*60));
    const minutes = Math.floor((distance % (1000*60*60))/(1000*60));
    const seconds = Math.floor((distance % (1000*60))/1000);

    document.getElementById("countdown").textContent =
      `Sisa waktu request: ${days}h ${hours}j ${minutes}m ${seconds}d`;
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);
}

checkDeadline();

/* === FORM SUBMIT === */
document.getElementById("requestForm").addEventListener("submit", function(e){
  e.preventDefault();
  checkDeadline();
  if(document.getElementById("submitBtn").disabled) return;

  const status=document.getElementById("status");
  status.textContent="⏳ Mengirim data...";
  status.className="";

  const formData=new FormData(e.target);
  fetch(scriptURL, { method:"POST", body: formData })
    .then(res=>res.text())
    .then(resText=>{
      if(resText.trim().startsWith("Sukses")){
        status.textContent="✅ "+resText.trim();
        status.className="success";
      } else {
        status.textContent="❌ "+resText.trim();
        status.className="error";
      }
    })
    .catch(()=>{
      status.textContent="❌ Gagal mengirim data! Cek koneksi.";
      status.className="error";
    });
});
</script>
</body>
</html>
