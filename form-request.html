<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>REQUEST LIBUR / CUTI JADWAL BULAN DEPAN</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h2 {
      text-align: center;
      color: #2193b0;
    }
    .field { margin-bottom: 20px; }
    label { font-weight: bold; display: block; margin-bottom: 6px; }
    input, select {
      padding: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
    }
    .calendar button {
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #eee;
      transition: 0.3s;
    }
    .calendar button.selected { background: #28a745; color: white; }
    .calendar button:hover { background: #2193b0; color: white; }
    .submit-btn {
      background: #28a745;
      color: white;
      font-weight: bold;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .submit-btn:hover { background: #1e7e34; }
  </style>
</head>
<body>

  <h2>REQUEST LIBUR / CUTI JADWAL BULAN DEPAN</h2>

  <!-- Data dari halaman NIK -->
  <div class="field">
    <label>NIK:</label>
    <input id="nik" type="text" readonly />
  </div>
  <div class="field">
    <label>Nama:</label>
    <input id="nama" type="text" readonly />
  </div>
  <div class="field">
    <label>Group:</label>
    <input id="group" type="text" readonly />
  </div>

  <!-- Kalender Libur -->
  <div class="field">
    <label>Pilih Request Libur (boleh lebih dari 1):</label>
    <div id="calendar-libur" class="calendar"></div>
  </div>

  <!-- Kalender Cuti -->
  <div class="field">
    <label>Pilih Request Cuti (boleh lebih dari 1):</label>
    <div id="calendar-cuti" class="calendar"></div>
  </div>

  <!-- Ekstrakurikuler -->
  <div class="field">
    <label>Ekstrakurikuler yang diikuti:</label>
    <select id="ekstra">
      <option value="">-- Pilih --</option>
      <option value="FUTSAL">FUTSAL</option>
      <option value="BADMINTON">BADMINTON</option>
      <option value="FUTSAL & BADMINTON">FUTSAL & BADMINTON</option>
      <option value="TIDAK MENGIKUTI">TIDAK MENGIKUTI</option>
    </select>
  </div>

  <button class="submit-btn" onclick="submitForm()">KIRIM REQUEST</button>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwG9sxBKZn5WF1P2mieKbKLhFGyURh6O5FY2i8cZ9JAZz_EbKxoavk4kuUtlCgkSFV_/exec"; // ganti dengan URL Apps Script

let liburSelected = [];
let cutiSelected = [];

// ambil param dari URL
function getParam(key){ return new URLSearchParams(window.location.search).get(key); }
document.getElementById("nik").value = getParam("nik") || "";
document.getElementById("nama").value = getParam("nama") || "";
document.getElementById("group").value = getParam("group") || "";

// generate kalender bulan depan
function generateCalendar(containerId, selectedArray) {
  const container = document.getElementById(containerId);
  const today = new Date();
  const year = today.getMonth() === 11 ? today.getFullYear() + 1 : today.getFullYear();
  const month = (today.getMonth() + 1) % 12; // bulan depan
  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  container.innerHTML = "";
  for (let i = 0; i < firstDay; i++) {
    container.innerHTML += "<div></div>";
  }
  for (let d = 1; d <= lastDate; d++) {
    const dateStr = String(d).padStart(2, "0") + "-" + String(month+1).padStart(2,"0") + "-" + year;
    const btn = document.createElement("button");
    btn.innerText = d;
    btn.onclick = () => {
      if (selectedArray.includes(dateStr)) {
        selectedArray.splice(selectedArray.indexOf(dateStr),1);
        btn.classList.remove("selected");
      } else {
        selectedArray.push(dateStr);
        btn.classList.add("selected");
      }
    };
    container.appendChild(btn);
  }
}
generateCalendar("calendar-libur", liburSelected);
generateCalendar("calendar-cuti", cutiSelected);

// kirim data
function submitForm(){
  const nik = document.getElementById("nik").value;
  const nama = document.getElementById("nama").value;
  const group = document.getElementById("group").value;
  const ekstra = document.getElementById("ekstra").value;

  if(!ekstra){ alert("Pilih Ekstrakurikuler!"); return; }

  fetch(scriptURL,{
    method:"POST",
    body: JSON.stringify({
      nik: nik,
      nama: nama,
      group: group,
      libur: liburSelected,
      cuti: cutiSelected,
      ekstra: ekstra
    })
  }).then(r=>r.json()).then(res=>{
    if(res.status==="success") alert("✅ Data berhasil disimpan!");
    else alert("❌ Gagal menyimpan.");
  }).catch(err=>{
    alert("⚠️ Error: "+err);
  });
}
</script>

</body>
</html>
