<script>
async function cekNIK() {
    const nik = document.getElementById("nik").value.trim();
    const hasil = document.getElementById("hasil");
    const btnForm = document.getElementById("formCutiBtn");

    // 1. Validasi Input
    if (!nik) {
        hasil.innerText = "‚ö†Ô∏è Silakan masukkan NIK.";
        btnForm.style.display = "none";
        return;
    }

    hasil.innerText = "üîÑ Mencari data...";
    btnForm.style.display = "none";

    const gasUrl = `https://script.google.com/macros/s/AKfycbz2Vcne0S9qUcVGCNan2ChqwcPdcqKbHVh3RdnCdK5e-UktyDu-uxVO_5uGccRQtctU/exec?nik=${nik}`;

    try {
        const response = await fetch(gasUrl);

        // 2. Penanganan Error HTTP (misalnya 404, 500)
        if (!response.ok) {
            throw new Error(`Kesalahan Jaringan: Status ${response.status}`);
        }

        const data = await response.json();

        // 3. Memeriksa Data yang Diterima
        if (data && data.nama && data.group) {
            hasil.innerHTML = `
                ‚úÖ Nama: <strong>${data.nama}</strong><br>
                üìå Group: <strong>${data.group}</strong>
            `;
            btnForm.style.display = "block";
            // Menyimpan data untuk fungsi lanjutForm
            btnForm.dataset.nama = data.nama;
            btnForm.dataset.nik = nik;
            btnForm.dataset.group = data.group;
        } else {
            // Jika Apps Script mengembalikan JSON tapi data.nama/data.group kosong
            hasil.innerText = "‚ùå NIK tidak ditemukan di database.";
        }
    } catch (err) {
        // Penanganan Error Jaringan atau JSON Parsing
        hasil.innerText = "‚ùå Gagal mengambil data. Cek URL Web App/Koneksi.";
        console.error("Kesalahan saat fetch data:", err);
    }
}

function lanjutForm() {
    const btn = document.getElementById("formCutiBtn");
    
    // Pastikan data sudah tersimpan di dataset sebelum digunakan
    if (!btn.dataset.nama || !btn.dataset.nik || !btn.dataset.group) {
        alert("Data NIK belum terverifikasi. Mohon Cek NIK terlebih dahulu.");
        return;
    }

    const nama = encodeURIComponent(btn.dataset.nama);
    const nik = encodeURIComponent(btn.dataset.nik);
    const group = encodeURIComponent(btn.dataset.group);

    // Menghubungkan ke form-request.html dengan Query String
    // Pastikan file form-request.html berada di folder yang sama atau diakses dengan path yang benar
    const formURL = `form-request.html?nik=${nik}&nama=${nama}&group=${group}`;

    window.location.href = formURL;
}
</script>
